notifications:
  email: false

matrix:
  include:
    - dist: trusty
      sudo: required
      services:
        - docker
      env: DOCKER_IMAGE=quay.io/pypa/manylinux1_x86_64
    - dist: trusty
      sudo: required
      services:
        - docker
      env: DOCKER_IMAGE=quay.io/pypa/manylinux1_i686
           PRE_CMD=linux32
    - dist: trusty
      language: python
      python: "3.6"
    - dist: trusty
      language: python
      python: "3.6"
      env: PYBASE64_TOX=1
    - os: osx
      osx_image: xcode8.2

install:
  - if [ "${DOCKER_IMAGE:-}" != "" ]; then
      docker pull $DOCKER_IMAGE;
    elif [ "${TRAVIS_OS_NAME}" == "osx" ]; then
      ./travis/install-python-macos.sh;
    elif [ "${PYBASE64_TOX}" != "" ]; then
      pip install -r requirements.txt codecov;
    else
      pip install -r requirements.txt;
    fi

script:
  - if [ "${DOCKER_IMAGE:-}" != "" ]; then
      docker run --rm -v `pwd`:/io $DOCKER_IMAGE $PRE_CMD /io/travis/build-wheels-docker.sh;
    elif [ "${TRAVIS_OS_NAME}" == "osx" ]; then
      ./travis/build-wheels-macos.sh;
    elif [ "${PYBASE64_TOX}" != "" ]; then
      python -m tox; mkdir todeploy; codecov;
    else
      ./travis/build-source-dist.sh;
    fi
  - ls todeploy/
